# 用户进程与内存管理

为了让CPU的执行更多的指令，需要操作系统支持多任务系统。要保证多任务系统正确运行，需要解决2个关键问题：
* 防止多个进程同时运行时，一个进程的代码和数据不会被其他进程直接访问，覆盖；
* 如何做到多进程有序轮流执行。

第一个问题涉及进程保护，第二个问题涉及进程调度。

## intel 物理地址，线性地址
1. 通过线性地址隔离物理地址
2. 分页解决了什么问题？

## intel 段基址，段限长，GDT，LDT，特权级
1. 通过段基址+IP的方式来访问物理内存，简化任务访问物理内存的操作
2. 通过段限长，限制任务可以访问物理内存的界限，保护任务的数据和代码，不会被修改
3. 将CPU指令划分特权级，规定某些特权级只有0的才能访问（0表示操作系统，3表示用户）
4. GDTR，LDTR这两个寄存器只能特权级为0才能访问，保证了GDT，LDT的安全，不会被仿造和篡改

## Intel 任务门，中断门，进程切换使用ljmp，iret
intel 提供了中断门技术，支持由3特权级代码段切换到0特权级代码段执行。不是普通的call 跳转，而是使用iret指令进行调整。需要硬件的中断机制支持

## 进程执行时分页
分页以及映射物理页面时，内核需要做到以下几点。 
1. 只能从空闲页面中分配新页面，不能分配其他进程正在使用的页面，干扰其他进程的执行，更不能将内核区域的页面挪作他用
2. 要明确什么时候该为进程新申请页面，什么时候不该申请。
3. 进程新申请的页面要映射到该进程的线性地址空间内。